<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skylight Familiar â€” v3 Real</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <style>
    :root{
      --bg:#f1f5f9;
      --dark-bg:#071426;
      --glass: rgba(255,255,255,0.06);
      --card-radius:20px;
      --muted:#9aa4b2;
      --blue:#9ad4ff; /* pastel bases for columns */
      --purple:#d9b8ff;
      --yellow:#ffe29a;
      --green:#b7f0d0;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#0b1b2b 0%, #072031 100%);color:#e6eef6;display:flex;justify-content:center;padding:28px
    }
    .wrap{width:100%;max-width:1400px}

    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:76px;height:76px;border-radius:16px;background:linear-gradient(90deg,#7c3aed,#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:22px;box-shadow:0 10px 30px rgba(124,58,237,0.18)}
    h1{margin:0;font-size:22px}
    .header-right{display:flex;gap:12px;align-items:center}
    .datetime{background:rgba(255,255,255,0.04);padding:10px 14px;border-radius:999px;color:var(--muted);font-weight:700}
    .weather{background:rgba(255,255,255,0.04);padding:10px 14px;border-radius:999px;color:var(--muted);display:flex;gap:8px;align-items:center}

    /* Main layout: people columns and sidebar */
    .main{display:grid;grid-template-columns:1fr 360px;gap:18px}

    /* People board columns */
    .board{display:flex;gap:12px}
    .col{flex:1;display:flex;flex-direction:column;gap:12px}
    .person{
      border-radius:16px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));backdrop-filter:blur(8px);box-shadow:0 8px 30px rgba(2,6,23,0.6);min-height:350px;display:flex;flex-direction:column}

    /* header inside column */
    .person-head{display:flex;align-items:center;gap:10px}
    .avatar{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#071426}
    .name{font-weight:800}
    .progress{margin-left:auto;background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-weight:700;color:var(--muted)}

    /* tasks list style */
    .task{margin-top:10px;padding:12px;border-radius:12px;background:white;color:#071426;display:flex;align-items:center;justify-content:space-between;box-shadow:0 6px 18px rgba(2,6,23,0.35)}
    .task .meta{display:flex;align-items:center;gap:10px}
    .task .title{font-weight:700}
    .task .sub{font-size:13px;color:#40566a}
    .check{width:28px;height:28px;border-radius:999px;background:rgba(255,255,255,0.9);display:flex;align-items:center;justify-content:center;cursor:pointer}

    /* rewards */
    .rewards{display:flex;align-items:center;gap:8px;margin-top:10px}
    .star{background:rgba(255,255,255,0.9);padding:6px;border-radius:8px;color:#071426;font-weight:800}

    /* sidebar */
    .sidebar{display:flex;flex-direction:column;gap:12px}
    .card{border-radius:16px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));backdrop-filter:blur(8px);box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    .events-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .ev{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02)}

    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}

    /* responsive */
    @media (max-width:1000px){.main{grid-template-columns:1fr}.board{flex-direction:column}.col{width:100%}}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">SF</div>
        <div>
          <h1>Skylight Familiar</h1>
          <div style="color:var(--muted);font-weight:600">Quadro de tarefas â€¢ v3 Real</div>
        </div>
      </div>

      <div class="header-right">
        <div class="datetime" id="dateTime">â€”</div>
        <div class="weather" id="weatherChip"><i class='bx bx-sun'></i><span id="temp">â€”</span></div>
        <div style="display:flex;gap:8px"><button class="btn" id="refreshBtn"><i class='bx bx-refresh'></i> Atualizar</button></div>
      </div>
    </header>

    <div class="main">
      <div>
        <div class="board">
          <!-- columns: RogÃ©rio / Ana / Lucas / Maria -->
          <div class="col">
            <div class="person" id="col-rogÃ©rio">
              <div class="person-head"><div class="avatar" style="background:linear-gradient(90deg,#9ad4ff,#60a5fa)">R</div><div><div class="name">RogÃ©rio</div><div class="small">Pai</div></div><div class="progress" id="prog-rogÃ©rio">0/0</div></div>
              <div id="tasks-rogÃ©rio"></div>
              <div class="rewards" id="stars-rogÃ©rio"></div>
            </div>
          </div>

          <div class="col">
            <div class="person" id="col-ana">
              <div class="person-head"><div class="avatar" style="background:linear-gradient(90deg,#f5c0d6,#ec4899)">A</div><div><div class="name">Ana</div><div class="small">MÃ£e</div></div><div class="progress" id="prog-ana">0/0</div></div>
              <div id="tasks-ana"></div>
              <div class="rewards" id="stars-ana"></div>
            </div>
          </div>

          <div class="col">
            <div class="person" id="col-lucas">
              <div class="person-head"><div class="avatar" style="background:linear-gradient(90deg,#fff0b3,#fbbf24)">L</div><div><div class="name">Lucas</div><div class="small">Filho</div></div><div class="progress" id="prog-lucas">0/0</div></div>
              <div id="tasks-lucas"></div>
              <div class="rewards" id="stars-lucas"></div>
            </div>
          </div>

          <div class="col">
            <div class="person" id="col-maria">
              <div class="person-head"><div class="avatar" style="background:linear-gradient(90deg,#bfffe0,#34d399)">M</div><div><div class="name">Maria</div><div class="small">Filha</div></div><div class="progress" id="prog-maria">0/0</div></div>
              <div id="tasks-maria"></div>
              <div class="rewards" id="stars-maria"></div>
            </div>
          </div>

        </div>
      </div>

      <aside class="sidebar">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center"><strong>PrÃ³ximos eventos (3 dias)</strong><small class="small">Agenda</small></div>
          <div class="events-list" id="eventsList">Carregando...</div>
        </div>

        <div class="card">
          <strong>Resumo rÃ¡pido</strong>
          <div class="small" id="summary">--</div>
        </div>

        <div class="card">
          <strong>Adicionar tarefa</strong>
          <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
            <input id="quickTitle" placeholder="Tarefa" style="padding:8px;border-radius:8px;border:none" />
            <select id="quickPerson" style="padding:8px;border-radius:8px;border:none">
              <option value="rogÃ©rio">RogÃ©rio</option>
              <option value="ana">Ana</option>
              <option value="lucas">Lucas</option>
              <option value="maria">Maria</option>
            </select>
            <div style="display:flex;gap:8px"><button class="btn" id="quickAdd">Adicionar</button><button class="btn" id="clearTasks">Limpar demo</button></div>
          </div>
        </div>

      </aside>
    </div>

    <footer>Skylight Familiar â€¢ v3 Real â€¢ Privado â€” feito por vocÃª</footer>
  </div>

  <script>
    // CONFIG: replace with your Apps Script URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxLF3o5PHBKapu6UthIW8Oee-D8yLVQ58Jqi5hTloLayZS2-dAo4vx4VJaxRN3tyvg/exec";

    const MEMBERS = ['rogÃ©rio','ana','lucas','maria'];

    // date/time and auto-theme
    function updateDate(){
      const now = new Date();
      const fmt = now.toLocaleString('pt-BR', {weekday:'long', day:'2-digit', month:'long'}) + ' â€¢ ' + now.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
      document.getElementById('dateTime').innerText = fmt;
      requestAnimationFrame(()=>{});
    }
    setInterval(updateDate,1000); updateDate();

    // fake weather (demo): we'll show basic icon/temperature; user can configure API key later
    function setDemoWeather(){ document.getElementById('temp').innerText = '25Â°C'; }
    setDemoWeather();

    // load events from Apps Script
    async function loadEvents(){
      const el = document.getElementById('eventsList');
      try{
        const res = await fetch(SCRIPT_URL,{cache:'no-store'});
        if(!res.ok) throw new Error('Erro');
        const data = await res.json();
        renderEvents(data);
      }catch(e){ el.innerHTML = '<div class="small">NÃ£o foi possÃ­vel carregar eventos.</div>'; console.warn(e); }
    }

    function renderEvents(events){
      const el = document.getElementById('eventsList'); el.innerHTML='';
      if(!events || !events.length){ el.innerHTML = '<div class="small">Sem eventos nos prÃ³ximos 3 dias.</div>'; return; }
      events.sort((a,b)=> new Date(a.start)-new Date(b.start));
      events.forEach(ev=>{
        const start = new Date(ev.start);
        const time = start.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
        const row = document.createElement('div'); row.className='ev';
        row.innerHTML = `<div><div style="font-weight:700">${ev.title}</div><div class='small'>${time} â€¢ ${ev.location||''}</div></div><div class='small'>${ev.description? 'ðŸ“‹':''}</div>`;
        el.appendChild(row);
      });
      document.getElementById('summary').innerText = `${events.length} evento(s) nos prÃ³ximos 3 dias`;
    }

    // tasks in localStorage under key sf-tasks
    function ensureDemo(){
      const key = 'sf-tasks';
      const cur = JSON.parse(localStorage.getItem(key)||'[]');
      if(cur.length) return;
      const demo = [
        {title:'Lavar louÃ§a',person:'ana',period:'evening',done:false,stars:1},
        {title:'Levar Lucas ao treino',person:'rogÃ©rio',period:'afternoon',done:false,stars:2},
        {title:'Arrumar quarto',person:'lucas',period:'morning',done:false,stars:1},
        {title:'Preparar lanche',person:'maria',period:'morning',done:false,stars:1}
      ];
      localStorage.setItem(key,JSON.stringify(demo));
    }

    function loadTasks(){
      const key = 'sf-tasks';
      const tasks = JSON.parse(localStorage.getItem(key)||'[]');
      // clear containers
      MEMBERS.forEach(m=>{ document.getElementById('tasks-'+m).innerHTML=''; document.getElementById('stars-'+m).innerHTML=''; });

      MEMBERS.forEach(m=>{
        const personTasks = tasks.filter(t=>t.person===m);
        const total = personTasks.length; const done = personTasks.filter(t=>t.done).length;
        document.getElementById('prog-'+m).innerText = `${done}/${total}`;

        // render tasks top-to-bottom
        personTasks.forEach((t,i)=>{
          const node = document.createElement('div'); node.className='task';
          const title = document.createElement('div'); title.className='meta';
          title.innerHTML = `<div style='width:44px;height:44px;border-radius:12px;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071426'>${t.title.charAt(0).toUpperCase()}</div><div style='margin-left:10px'><div class='title'>${t.title}</div><div class='sub'>${t.period || 'Daily'}</div></div>`;
          const ch = document.createElement('div'); ch.className='check'; ch.innerHTML = t.done ? "<i class='bx bx-check-circle' style='color:green'></i>" : "";
          ch.addEventListener('click',()=>{ toggleDone(m,t.title); });
          node.appendChild(title); node.appendChild(ch);
          document.getElementById('tasks-'+m).appendChild(node);
        });

        // stars (rewards) auto-calculated: 1 star per done task (cap at 10)
        const starsCount = Math.min(10, personTasks.filter(t=>t.done).reduce((s,t)=>s+(t.stars||1),0));
        for(let s=0;s<starsCount;s++){ const el = document.createElement('div'); el.className='star'; el.textContent='â˜…'; document.getElementById('stars-'+m).appendChild(el);} 
      });
    }

    function toggleDone(person,title){
      const key='sf-tasks'; const tasks = JSON.parse(localStorage.getItem(key)||'[]');
      const idx = tasks.findIndex(t=>t.person===person && t.title===title);
      if(idx>=0){ tasks[idx].done = !tasks[idx].done; localStorage.setItem(key,JSON.stringify(tasks)); loadTasks(); }
    }

    // quick add
    document.getElementById('quickAdd').addEventListener('click',()=>{
      const title = document.getElementById('quickTitle').value.trim(); const person = document.getElementById('quickPerson').value;
      if(!title) return alert('Digite tÃ­tulo');
      const key='sf-tasks'; const tasks = JSON.parse(localStorage.getItem(key)||'[]'); tasks.push({title,person,period:'daily',done:false,stars:1}); localStorage.setItem(key,JSON.stringify(tasks)); document.getElementById('quickTitle').value=''; loadTasks();
    });

    document.getElementById('clearTasks').addEventListener('click',()=>{ localStorage.removeItem('sf-tasks'); ensureDemo(); loadTasks(); });

    // init
    ensureDemo(); loadTasks(); loadEvents();
    document.getElementById('refreshBtn').addEventListener('click',()=>{ loadEvents(); loadTasks(); });

  </script>
</body>
</html>
